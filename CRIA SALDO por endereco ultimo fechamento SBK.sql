

--BEGIN TRANSACTION INSERT INTO SBK010 (BK_FILIAL,BK_COD,BK_LOCAL,BK_DATA,BK_QINI,BK_QISEGUM,BK_NUMLOTE,BK_LOTECTL,BK_PRIOR,BK_LOCALIZ,BK_NUMSERI,R_E_C_N_O_)
SELECT 
BK_FILIAL,
BK_COD,
BK_LOCAL,
'20210331' BK_DATA,
BK_QINI,
BK_QISEGUM,
BK_NUMLOTE,
BK_LOTECTL,
BK_PRIOR,
BK_LOCALIZ,
BK_NUMSERI,
(SELECT ISNULL(MAX(R_E_C_N_O_),0) FROM SBK010)+ rank() OVER (ORDER BY R_E_C_N_O_) R_E_C_N_O_
FROM SBK010
WHERE BK_FILIAL='010101'
AND BK_DATA=''
AND BK_COD<>'005706'
--AND B8_PRODUTO='000757'
--AND B8_PRODUTO IN (
--'000757',         
--'005406',         
--'006455',         
--'007516',         
--'008938') 
--AND B8_SALDO >0
AND D_E_L_E_T_=''
--COMMIT
--ROLLBACK

SELECT * 

--BEGIN TRANSACTION UPDATE SBK SET D_E_L_E_T_='*'	,	R_E_C_D_E_L_=R_E_C_N_O_

FROM SBK010 SBK
WHERE BK_DATA='20210331'
AND BK_COD='005706'

