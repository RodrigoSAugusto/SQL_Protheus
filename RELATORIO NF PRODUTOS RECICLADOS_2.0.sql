--###############################################################################################################################################
--#1  PEDIDO DE VENDA
SELECT 
--C6_PRODUTO,C6_NUMOP,C6_ITEMOP, C6_NOTA,C6_SERIE,

D4_FILIAL,
SD3B.D3_COD PRODUTO_ACABADO,
SD3A.D3_COD PRODUTO_EM_PROCESSO,
SD3A.D3_QUANT,
B1_GRUPO,
B1_TIPO,
B1_DESC,
D4_OP OP_PA,
SD3B.D3_CUSTO1 CUSTO_PA,
SD3A.D3_CUSTO1 CUSTO_PP,
SD3A.D3_CUSTO1/SD3B.D3_CUSTO1*100.0 PERCENT_C_PP,
SD3B.D3_LOTECTL LOTE_PA,
--SD3B.D3_LOTECTL LOTE_PP,
SD4A.D4_LOTECTL LOTE_PP,
SD3C.D3_OP OP_PP,
--SD3C.D3_CUSTO1 CUSTO_ME,
SD3C.D3_QUANT QTD_ME

--,SD4A.*
--,SD3C.*

--,* 
FROM SC6010 SC6
--JOIN SD4010 SD4A ON SD4A.D4_FILIAL=C6_FILIAL AND SD4A.D4_OP=C6_NUMOP+C6_ITEMOP+'001' AND SD4A.D_E_L_E_T_=''
JOIN SD4010 SD4A ON SD4A.D4_FILIAL=C6_FILIAL AND SUBSTRING(SD4A.D4_OP,1,8)=C6_NUMOP+C6_ITEMOP AND SD4A.D_E_L_E_T_='' AND SD4A.D4_PRODUTO=SC6.C6_PRODUTO
JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD AND SB1.D_E_L_E_T_='' AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14','MN34') 
JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
LEFT JOIN SD3010 SD3C ON SD3C.D3_FILIAL=SD3A.D3_FILIAL AND SD3A.D3_COD = SD3C.D3_COD AND SD3C.D3_LOTECTL = SD4A.D4_LOTECTL AND SD3C.D3_TM='010'

WHERE 1=1
--AND C6_NUMOP	='006302'
--AND C6_ITEMOP='02'
--AND C6_PRODUTO='023597'
and C6_NOTA	='000097745'
and C6_SERIE ='001'
AND SC6.D_E_L_E_T_=''
      	  
--###############################################################################################################################################
--NF
select 
--C6_NUMOP,C6_ITEMOP,D4_OP,B1_GRUPO,B1_COD,* 
F2_DOC,F2_SERIE,
D4_FILIAL,
SD3B.D3_COD PRODUTO_ACABADO,
SD3A.D3_COD PRODUTO_EM_PROCESSO,
SB1B.B1_DESC DESC_PA,
SB1B.B1_GRUPO GRUPO_PA,
SB1A.B1_DESC DESC_PP,
SB1A.B1_GRUPO GRUPO_PP,
D4_OP OP_PA,
D2_CUSTO1 CUSTO_PA,
--SD3B.D3_CUSTO1 CUSTO_PA,
SD3A.D3_CUSTO1 CUSTO_PP,
CASE WHEN D2_CUSTO1<>0 THEN ROUND(SD3A.D3_CUSTO1/D2_CUSTO1*1.0,6) ELSE 99999999999999999999999999 END PERCENT_C_PP,
SD3B.D3_LOTECTL LOTE_PA,
SD3A.D3_LOTECTL LOTE_PP
from SF2010 SF2 
JOIN SD2010 SD2 ON D2_FILIAL=F2_FILIAL AND D2_DOC = F2_DOC AND D2_SERIE=F2_SERIE AND SD2.D_E_L_E_T_=''
JOIN SC6010 SC6 ON C6_FILIAL=F2_FILIAL AND C6_NOTA= D2_DOC AND C6_SERIE = D2_SERIE AND D2_COD=C6_PRODUTO AND  SC6.D_E_L_E_T_=''
JOIN SD4010 SD4A ON SD4A.D4_FILIAL=C6_FILIAL AND SUBSTRING(SD4A.D4_OP,1,8)=C6_NUMOP+C6_ITEMOP AND SD4A.D_E_L_E_T_='' AND SD4A.D4_PRODUTO=SC6.C6_PRODUTO
JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
JOIN SB1010 SB1A ON SB1A.B1_FILIAL=D4_FILIAL AND D4_COD = SB1A.B1_COD 
AND SB1A.B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14', 'MN34') 
AND SB1A.D_E_L_E_T_=''
JOIN SB1010 SB1B ON SB1B.B1_FILIAL=D4_FILIAL AND D4_PRODUTO = SB1B.B1_COD AND SB1B.D_E_L_E_T_=''
WHERE  1=1
AND C6_NOTA	='000097745'
--and C6_SERIE ='001'
--AND SC6.D_E_L_E_T_=''
AND F2_EMISSAO BETWEEN '20201201' AND '20210120'
AND SF2.D_E_L_E_T_=''
AND SD3B.D3_CUSTO1 <SD3A.D3_CUSTO1
AND D4_OP='01093801001'
      	  



--SELECT SD3B.D3_CUSTO1 CUSTO_PA,
--SD3A.D3_CUSTO1 CUSTO_PP,
--SD3B.D3_QUANT QTD_PA,
--SD3A.D3_QUANT QTD_PP,
--* FROM SD4010
--JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
--JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP  AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
--WHERE D4_OP='01093801001'

select * from SD3010
WHERE D3_OP='01093801001'
AND D3_COD IN ('014591','008460')


--###############################################################################################################################################
SELECT D4_FILIAL,
SD3B.D3_COD PRODUTO_ACABADO,
SD3A.D3_COD PRODUTO_EM_PROCESSO,
B1_GRUPO,
D4_OP OP_PA,
SD3B.D3_CUSTO1 CUSTO_PA,
SD3A.D3_CUSTO1 CUSTO_PP,
SD3A.D3_CUSTO1/SD3B.D3_CUSTO1*100 PERCENT_C_PP,
SD3B.D3_UM	UM_PA,
SD3A.D3_UM	UM_PP,
SD3B.D3_QUANT QTD_PA,
SD3A.D3_QUANT QTD_PP,
SD3B.D3_LOTECTL LOTE_PA,
SD3A.D3_LOTECTL LOTE_PP
--,SD3A.*
,*
FROM SD4010 SD4
JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD 
AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14', 'MN34') AND SB1.D_E_L_E_T_=''
JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP AND SD3B.D3_NUMSEQ=SD3A.D3_NUMSEQ AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
WHERE 1=1
AND D4_FILIAL='020101'
AND D4_OP='I0058901001'
AND SD4.D_E_L_E_T_=''
--and SD3A.D3_OP ='I0108101001'

--select BM_DESC,B1_TIPO,B1_DESC,B1_GRUPO, * from SD4010
--JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD --AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14','MN34') AND SB1.D_E_L_E_T_=''
--JOIN SBM010 SBM ON B1_FILIAL = BM_FILIAL AND B1_GRUPO = BM_GRUPO 
--WHERE 1=1
--AND D4_FILIAL='020101'
--AND D4_OP='00630202001'

--SELECT * FROM SBM010


    

SELECT * FROM SD3010
WHERE 1=1 AND D3_COD='008442'
and D3_LOTECTL='0000065187'
and D3_OP ='I0108101001'