
select 
F2_VALICM,F2_BASIMP5,F2_BASIMP6,F2_VALIMP5,F2_VALIMP6,F2_ICMSDIF,
* 
--begin transaction update SF2 SET  F2_VALICM=699.87
from SF2010 SF2
WHERE F2_DOC='000113712'

SELECT
(SELECT MIN(D2_ITEM) FROM SD2010 SD2B WHERE AAA.D2_DOC=SD2B.D2_DOC AND AAA.D2_COD=SD2B.D2_COD)ITEM,
D2_DOC,
D2_COD,
D2_QUANT,
D2_BASEICM,
D2_VALICM,
ROUND ((D2_BASEICM * 0.18) * 0.6667,2)VALICMS_CALC,
ROUND (D2_BASEICM * 0.04,2)VALICMS_04_CALC,
D2_ICMSDIF,
ROUND((D2_BASEICM * 0.18)- ((D2_BASEICM * 0.18) * 0.6667) ,2)ICMSDIF_CALC,
D2_VOPDIF,
round((D2_BASEICM * 0.18),2)VOPDIF_CALC
FROM (
SELECT 
D2_DOC,
D2_COD,
SUM(D2_QUANT)D2_QUANT,
--D2_VALICM,D2_ICMSDIF,D2_VOPDIF,D2_BASIMP5,D2_BASIMP6,D2_VALIMP5,D2_VALIMP6,
SUM(D2_BASEICM)D2_BASEICM,
SUM(D2_VALICM)D2_VALICM,
SUM(D2_ICMSDIF)D2_ICMSDIF,
SUM(D2_VOPDIF)D2_VOPDIF
--SELECT SUM(D2_VALICM)D2_VALICM, SUM(D2_ICMSDIF)D2_ICMSDIF, SUM(D2_VOPDIF)D2_VOPDIF
--begin transaction update SD2 SET D2_VALICM=76.96 --,D2_ICMSDIF=118.60,D2_VOPDIF=355.80
--begin transaction update SD2 SET D2_VALICM=ROUND ((D2_BASEICM * 0.18) * 0.6667,2),D2_ICMSDIF=ROUND((D2_BASEICM * 0.18)- ((D2_BASEICM * 0.18) * 0.6667),2) ,D2_VOPDIF=ROUND((D2_BASEICM * 0.18),2)
FROM SD2010 SD2
where D2_DOC='000113712'
and D_E_L_E_T_=''
GROUP BY D2_COD,D2_DOC
)AAA


--rollback
--commit

--SELECT 
----D2_VALICM,D2_ICMSDIF,D2_VOPDIF,D2_BASIMP5,D2_BASIMP6,D2_VALIMP5,D2_VALIMP6,
--D2_VALICM,ROUND ((D2_BASEICM * 0.18) * 0.6667,2)VALICMS_CALC,
select D2_ITEM, D2_COD, D2_BASEICM,D2_VALICM, ROUND (D2_BASEICM * 0.04,2)VALICMS_CALC,ROUND ((D2_BASEICM * 0.18) * 0.6667,2)VALICMS_CALC,D2_ICMSDIF,ROUND((D2_BASEICM * 0.18)- ((D2_BASEICM * 0.18) * 0.6667) ,2)ICMSDIF_CALC,D2_VOPDIF,round((D2_BASEICM * 0.18),2)VOPDIF_CALC, D2_CLIENTE,*
--D2_VOPDIF,round((D2_BASEICM * 0.18),2)VOPDIF_CALC,
--SELECT *
--SELECT SUM(D2_VALICM)D2_VALICM, SUM(D2_ICMSDIF)D2_ICMSDIF, SUM(D2_VOPDIF)D2_VOPDIF

--begin transaction update SD2 SET D2_VALICM=136.42,D2_VOPDIF=204.62,D2_ICMSDIF=68.21

--begin transaction update SD2 SET D2_BASEICM=635.56 ,D2_VALICM=114.40

--begin transaction update SD2 SET D2_VOPDIF =57.52
--begin transaction update SD2 SET D2_ICMSDIF=D2_ICMSDIF-0.01
--begin transaction update SD2 SET D2_VALICM =D2_VALICM -0.01

FROM SD2010 SD2
where D2_DOC='000113712'
--and D2_COD='019939'
--AND D2_CLIENTE='037885'
and D_E_L_E_T_=''
and D2_ITEM IN('07')
--and D2_ITEM IN('10','22','05','15')
--and D2_ITEM IN('22','24','18','05','15')


--COMMIT
--rollback


SELECT
(SELECT MIN(FT_ITEM) FROM SFT010 SFTB WHERE AAA.FT_NFISCAL=SFTB.FT_NFISCAL AND AAA.FT_PRODUTO=SFTB.FT_PRODUTO)ITEM,
FT_PRODUTO,FT_BASEICM,
FT_VALICM,
ROUND ((FT_BASEICM * 0.18) * 0.6667,2)VALICMS_CALC,
FT_ICMSDIF,
ROUND((FT_BASEICM * 0.18)- ((FT_BASEICM * 0.18) * 0.6667) ,2)ICMSDIF_CALC,
FT_VOPDIF,
round((FT_BASEICM * 0.18),2)VOPDIF_CALC
FROM (
SELECT 
FT_NFISCAL,
FT_PRODUTO,
--FT_VALICM,FT_ICMSDIF,FT_VOPDIF,FT_BASIMP5,FT_BASIMP6,FT_VALIMP5,FT_VALIMP6,
SUM(FT_BASEICM)FT_BASEICM,
SUM(FT_VALICM)FT_VALICM,
SUM(FT_ICMSDIF)FT_ICMSDIF,
SUM(FT_VOPDIF)FT_VOPDIF
--SELECT SUM(FT_VALICM)FT_VALICM, SUM(FT_ICMSDIF)FT_ICMSDIF, SUM(FT_VOPDIF)FT_VOPDIF
--begin transaction update SFT SET FT_VOPDIF=19.85
--begin transaction update SFT SET FT_VALICM=ROUND ((FT_BASEICM * 0.18) * 0.6667,2),FT_ICMSDIF=ROUND((FT_BASEICM * 0.18)- ((FT_BASEICM * 0.18) * 0.6667),2) ,FT_VOPDIF=ROUND((FT_BASEICM * 0.18),2)
FROM SFT010 SFT
where FT_NFISCAL='000113712'
AND FT_CLIEFOR='037885'
and D_E_L_E_T_=''
GROUP BY FT_NFISCAL,FT_PRODUTO
)AAA



SELECT FT_PRODUTO,FT_NFISCAL,FT_ITEM,FT_ICMSDIF, '',--FT_CLIEFOR,	FT_LOJA, FT_ESTADO,	FT_CFOP,FT_QUANT,FT_PRCUNIT,FT_VALCONT,FT_BASEICM,FT_ALIQICM,
FT_VALICM,ROUND ((FT_BASEICM * 0.18) * 0.6667,2)VALICMS_CALC,
FT_ICMSDIF,ROUND((FT_BASEICM * 0.18)- ((FT_BASEICM * 0.18) * 0.6667) ,2)ICMSDIF_CALC,
FT_VOPDIF,round((FT_BASEICM * 0.18),2)VOPDIF_CALC,
FT_BASEIPI,	FT_VALIPI,
*
--begin transaction update SFT SET  FT_VALICM=136.42,FT_VOPDIF=204.62, FT_ICMSDIF=68.21
--begin transaction update SFT SET  FT_VALICM=FT_VALICM-0.01

--begin transaction update SFT SET FT_VOPDIF=57.52
--begin transaction update SFT SET FT_ICMSDIF=FT_ICMSDIF-0.01 
--begin transaction update SFT SET FT_VALICM=FT_VALICM  -0.01
FROM SFT010 SFT
where FT_NFISCAL='000113712  '
--and FT_PRODUTO='001705'         
AND D_E_L_E_T_=''
AND FT_CLIEFOR='037885'
and FT_ITEM IN('07')
--and FT_ITEM IN('24','22','05','15','18')
--and FT_ITEM IN('14','24','18')

--ROLLBACK
--COMMIT


select 
F2_VALICM,F2_BASIMP5,F2_BASIMP6,F2_VALIMP5,F2_VALIMP6,F2_ICMSDIF,
* 
--begin transaction update SF2 SET F2_VALICM=163.32  
--begin transaction update SF2 SET F2_ICMSDIF=81.65

from SF2010 SF2
WHERE F2_DOC='000113712'

SELECT SUM(FT_VALICM)FT_VALICM,SUM(FT_ICMSDIF)FT_ICMSDIF,SUM(FT_BASEPIS)FT_BASEPIS,SUM(FT_BASECOF)FT_BASECOF,SUM(FT_VALCOF)FT_VALCOF,SUM(FT_VOPDIF)FT_VOPDIF
FROM SFT010 SFT
where FT_NFISCAL='000113712'
AND D_E_L_E_T_=''
AND FT_CLIEFOR='037885'
--and FT_ITEM in ('01')
GROUP BY FT_NFISCAL--,FT_VALICM,FT_ICMSDIF,FT_BASEPIS,FT_BASECOF,FT_VALCOF,FT_VOPDIF

--FT_VALICM=115.05
--FT_VOPDIF=172.57


SELECT 
F3_VALICM,F3_BASEIPI,F3_ICMSDIF,F3_BSICMOR,F3_OUTRICM,F3_VALCONT,	F3_BASEICM,
* 
--BEGIN TRANSACTION UPDATE SF3 SET F3_VALICM=115.05
--BEGIN TRANSACTION UPDATE SF3 SET F3_ICMSDIF=172.57
	
FROM SF3010 SF3
WHERE F3_NFISCAL='000113712'
AND F3_CLIEFOR='037885'
--and F3_CFO='5152'
--823.89	411.89

SELECT D_E_L_E_T_,
CONVERT(varchar(MAX),CONVERT(VARBINARY(MAX), XML_ERP)) as XML_ERP2,
* 
--BEGIN TRANSACTION UPDATE SPED SET D_E_L_E_T_ ='*', 	R_E_C_D_E_L_ =R_E_C_N_O_
--BEGIN TRANSACTION UPDATE SPED set STATUS ='7',	STATUSCANC ='2', STATUSMAIL = '3', D_E_L_E_T_='', R_E_C_D_E_L_=''
FROM tss_nfe_producao..SPED050 SPED
WHERE 1=1
--and NFE_ID LIKE'%000302787%'
and NFE_ID LIKE'%000113712%'
--AND ID_ENT='000013'
--COMMIT


--MENSAGENS DA NF(PARA VER QUAL O ERRO DA TRANSMISSAO)
select *
FROM tss_nfe_producao..SPED054 S54
WHERE NFE_ID LIKE'%000113712%'


--ROLLBACK
--COMMIT



SELECT C5_INDPRES ,* 
--BEGIN TRANSACTION UPDATE SC5 SET C5_INDPRES='1'
FROM SC5010 SC5
WHERE C5_NUM='001610'
AND C5_FILIAL='010101'
--COMMIT