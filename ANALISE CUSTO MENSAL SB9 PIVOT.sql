--PIVOT USANDO CASE COM MAIS DE UMA COLUNA NO PIVOT

SELECT B9_FILIAL,	B9_COD,	B9_LOCAL,	
isnull(SUM(C_JAN),0)C_JAN,	
isnull(SUM(Q_JAN),0)Q_JAN,	
isnull(SUM(C_FEV),0)C_FEV,	
isnull(SUM(Q_FEV),0)Q_FEV,	
isnull(SUM(C_MAR),0)C_MAR,	
isnull(SUM(Q_MAR),0)Q_MAR,	
isnull(SUM(C_ABR),0)C_ABR,	
isnull(SUM(Q_ABR),0)Q_ABR,	
isnull(SUM(C_MAI),0)C_MAI,
isnull(SUM(Q_MAI),0)Q_MAI,
isnull(SUM(C_JUN),0)C_JUN,
isnull(SUM(Q_JUN),0)Q_JUN,
isnull(SUM(C_JUL),0)C_JUL,
isnull(SUM(Q_JUL),0)Q_JUL,
isnull(SUM(C_AGO),0)C_AGO,
isnull(SUM(Q_AGO),0)Q_AGO,
isnull(SUM(C_SET),0)C_SET,
isnull(SUM(Q_SET),0)Q_SET,
isnull(SUM(C_OUT),0)C_OUT,
isnull(SUM(Q_OUT),0)Q_OUT,
isnull(SUM(C_NOV),0)C_NOV,
isnull(SUM(Q_NOV),0)Q_NOV,
isnull(SUM(C_DEZ),0)C_DEZ,
isnull(SUM(Q_DEZ),0)Q_DEZ

FROM (
	SELECT B9_FILIAL
	,B9_COD
	,B9_LOCAL
	,B9_DATA
	--,B9_QINI
	--,B9_VINI1
	--,B9_CM1
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202001'THEN  B9_CM1 END C_JAN 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202002'THEN  B9_CM1 END C_FEV 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202003'THEN  B9_CM1 END C_MAR 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202004'THEN  B9_CM1 END C_ABR 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202005'THEN  B9_CM1 END C_MAI 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202006'THEN  B9_CM1 END C_JUN 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202007'THEN  B9_CM1 END C_JUL 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202008'THEN  B9_CM1 END C_AGO 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202009'THEN  B9_CM1 END C_SET 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202010'THEN  B9_CM1 END C_OUT 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202011'THEN  B9_CM1 END C_NOV 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202012'THEN  B9_CM1 END C_DEZ 

	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202001'THEN  B9_QINI END Q_JAN 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202002'THEN  B9_QINI END Q_FEV 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202003'THEN  B9_QINI END Q_MAR 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202004'THEN  B9_QINI END Q_ABR 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202005'THEN  B9_QINI END Q_MAI 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202006'THEN  B9_QINI END Q_JUN 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202007'THEN  B9_QINI END Q_JUL 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202008'THEN  B9_QINI END Q_AGO 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202009'THEN  B9_QINI END Q_SET 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202010'THEN  B9_QINI END Q_OUT 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202011'THEN  B9_QINI END Q_NOV 
	, CASE WHEN(SUBSTRING (B9_DATA,1,6))='202012'THEN  B9_QINI END Q_DEZ 

	 FROM SB9010 SB9
	WHERE 1=1 
	--AND B9_QINI>0
	AND B9_FILIAL='010101'
	AND B9_COD='014561'
	AND SB9.D_E_L_E_T_=''

)AAA
where 1=1


--and (
--	(C_JAN=0 and Q_JAN>0) or
--	(C_FEV=0 and Q_FEV>0) or
--	(C_MAR=0 and Q_MAR>0) or
--	(C_ABR=0 and Q_ABR>0) or
--	(C_MAI=0 and Q_MAI>0) or
--	(C_JUN=0 and Q_JUN>0) or
--	(C_JUL=0 and Q_JUL>0) or
--	(C_AGO=0 and Q_AGO>0) or
--	(C_SET=0 and Q_SET>0) or
--	(C_OUT=0 and Q_OUT>0) or
--	(C_NOV=0 and Q_NOV>0) or
--	(C_DEZ=0 and Q_DEZ>0)
--	)
	--and C_DEZ>0

--and C_JAN=0 and Q_JAN>0

--and C_DEZ=0
--and Q_DEZ>0
group by B9_FILIAL,B9_COD,B9_LOCAL


----PIVOT COMUM DE UMA COLUNA
--SELECT B9_FILIAL
--,B9_COD
--,B9_LOCAL
--,ISNULL( SUM ([202001]) , 0 ) "C_JAN"
--,ISNULL( SUM ([202002]) , 0 ) "C_FEV"
--,ISNULL( SUM ([202003]) , 0 ) "C_MAR"
--,ISNULL( SUM( [202004]) , 0 ) "C_ABR"
--,ISNULL( SUM( [202005]) , 0 ) "C_MAI"
--,ISNULL( SUM( [202006]) , 0 ) "C_JUN"
--,ISNULL( SUM( [202007]) , 0 ) "C_JUL"
--,ISNULL( SUM( [202008]) , 0 ) "C_AGO"
--,ISNULL( SUM( [202009]) , 0 ) "C_SET"
--,ISNULL( SUM( [202010]) , 0 ) "C_OUT"
--,ISNULL( SUM( [202011]) , 0 ) "C_NOV"
--,ISNULL( SUM( [202012]) , 0 ) "C_DEZ"

--FROM  
--    (SELECT B9_FILIAL,B9_COD,B9_LOCAL,SUBSTRING (B9_DATA,1,6) DATA,B9_CM1--,B9_QINI,B9_VINI1
--	FROM SB9010
--	WHERE 1=1  		
--	AND B9_FILIAL='010101'		
--	AND B9_COD='017043'
--	AND D_E_L_E_T_=''
--	)	
--	AS RESULT  
	
--PIVOT (
--	SUM(B9_CM1) FOR DATA IN ([202001],[202002],[202003],[202004],[202005],[202006],[202007],[202008],[202009],[202010],[202011],[202012]) 
--	 ) PVT_CUSTO

--GROUP BY  B9_FILIAL,B9_COD,B9_LOCAL
--ORDER BY B9_COD
