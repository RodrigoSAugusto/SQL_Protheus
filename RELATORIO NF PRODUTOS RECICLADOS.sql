--OP Interna (produção de Produto em Processo)     = OI0058901001
--OP Pedido  (Venda PA com origem da MP Reciclada) = 00630202001


--###############################################################################################################################################
--#1  PEDIDO DE VENDA
SELECT C6_PRODUTO,C6_NUMOP, C6_NUM,C6_ITEMOP, C6_NOTA,C6_SERIE,* FROM SC6010
WHERE 1=1
--AND C6_NUMOP	='006302'
--AND C6_ITEMOP='02'
--AND C6_PRODUTO='023597'
and C6_NOTA	='000093090'
and C6_SERIE ='001'
      	  


--###############################################################################################################################################
--#2 OP PRODUTO ACABADO
SELECT D4_FILIAL,
SD3B.D3_COD PRODUTO_ACABADO,
SD3A.D3_COD PRODUTO_EM_PROCESSO,
B1_DESC,B1_GRUPO,
D4_OP OP_PA,
SD3B.D3_CUSTO1 CUSTO_PA,
SD3A.D3_CUSTO1 CUSTO_PP,
SD3A.D3_CUSTO1/SD3B.D3_CUSTO1*100 PERCENT_C_PP,
SD3B.D3_LOTECTL LOTE_PA,
SD3A.D3_LOTECTL LOTE_PP
--,SD3A.* 
FROM SD4010 SD4
JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD  AND SB1.D_E_L_E_T_=''
AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14','MN34')
JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
WHERE 1=1
AND D4_FILIAL='020101'
AND D4_OP='00630202001'
AND SD4.D_E_L_E_T_=''




--###############################################################################################################################################
--#3 OP PRODUTO INTERMEDIARIO
SELECT D4_FILIAL,
SD3B.D3_COD PRODUTO_ACABADO,
SD3A.D3_COD PRODUTO_EM_PROCESSO,
B1_DESC,
B1_GRUPO,
D4_LOTECTL,
D4_OP OP_PA,
SD3B.D3_CUSTO1 CUSTO_PA,
SD3A.D3_CUSTO1 CUSTO_PP,
SD3A.D3_CUSTO1/SD3B.D3_CUSTO1*100 PERCENT_C_PP,
SD3B.D3_UM	UM_PA,
SD3A.D3_UM	UM_PP,
SD3B.D3_QUANT QTD_PA,
SD3A.D3_QUANT QTD_PP,
SD3B.D3_LOTECTL LOTE_PA,
SD3A.D3_LOTECTL LOTE_PP
--,SD3A.*
,*
FROM SD4010 SD4
left JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD AND SB1.D_E_L_E_T_=''
--AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14', 'MN34') 
JOIN SD3010 SD3A ON SD3A.D3_FILIAL = D4_FILIAL AND SD3A.D3_OP = D4_OP AND SD3A.D3_COD =D4_COD AND SD3A.D_E_L_E_T_=''
JOIN SD3010 SD3B ON SD3B.D3_FILIAL = D4_FILIAL AND SD3B.D3_OP = D4_OP AND SD3B.D3_NUMSEQ=SD3A.D3_NUMSEQ AND SD3B.D3_TM ='010'AND SD3B.D_E_L_E_T_=''
WHERE 1=1
AND D4_FILIAL='020101'
AND SD3B.D3_COD='008442'
AND SD3B.D3_LOTECTL='0000065187'
--AND D4_OP='I0058901001'
AND SD4.D_E_L_E_T_=''
--AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14', 'MN34') 

select BM_DESC,B1_TIPO,B1_DESC,B1_GRUPO, * from SD4010
JOIN SB1010 SB1 ON B1_FILIAL=D4_FILIAL AND D4_COD = B1_COD --AND B1_GRUPO IN('PA01', 'PA02', 'PA03', 'PA04', 'PP13' ,'PP14','MN34') AND SB1.D_E_L_E_T_=''
JOIN SBM010 SBM ON B1_FILIAL = BM_FILIAL AND B1_GRUPO = BM_GRUPO 
WHERE 1=1
AND D4_FILIAL='020101'
AND D4_OP='00630202001'

SELECT * FROM SBM010